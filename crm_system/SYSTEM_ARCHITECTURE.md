# CRM ç³»çµ±æ¶æ§‹æ–‡æª” / CRM System Architecture Documentation

## ğŸ—ï¸ ç³»çµ±æ¶æ§‹æ¦‚è¦½ / System Architecture Overview

### æ•´é«”æ¶æ§‹ / Overall Architecture
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   ç”¨æˆ¶ç«¯        â”‚    â”‚   è² è¼‰å‡è¡¡å™¨     â”‚    â”‚   Web ä¼ºæœå™¨    â”‚
â”‚  (ç€è¦½å™¨)      â”‚â—„â”€â”€â–ºâ”‚   (Apache)      â”‚â—„â”€â”€â–ºâ”‚   (Next.js)     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                â”‚                       â”‚
                                â–¼                       â–¼
                       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                       â”‚   è³‡æ–™åº«        â”‚    â”‚   å¿«å–å±¤        â”‚
                       â”‚  (MongoDB)     â”‚    â”‚  (Memory)       â”‚
                       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ”§ æŠ€è¡“æ£§ / Technology Stack

### å‰ç«¯æŠ€è¡“ / Frontend Technologies
- **æ¡†æ¶ / Framework:** Next.js 14 (App Router)
- **èªè¨€ / Language:** TypeScript
- **æ¨£å¼ / Styling:** Tailwind CSS
- **ç‹€æ…‹ç®¡ç† / State Management:** React Context API
- **è¡¨å–®è™•ç† / Form Handling:** React Hook Form
- **åœ–è¡¨ / Charts:** Chart.js (å¯é¸)

### å¾Œç«¯æŠ€è¡“ / Backend Technologies
- **é‹è¡Œæ™‚ / Runtime:** Node.js 18+
- **æ¡†æ¶ / Framework:** Next.js API Routes
- **è³‡æ–™åº« / Database:** MongoDB (Mongoose)
- **èªè­‰ / Authentication:** JWT + bcrypt
- **é©—è­‰ / Validation:** Zod

### ä¼ºæœå™¨æŠ€è¡“ / Server Technologies
- **Web ä¼ºæœå™¨ / Web Server:** Apache 2.4 (Reverse Proxy)
- **æ‡‰ç”¨ä¼ºæœå™¨ / App Server:** Next.js Standalone
- **è² è¼‰å‡è¡¡ / Load Balancing:** Apache mod_proxy
- **SSL çµ‚æ­¢ / SSL Termination:** Apache mod_ssl

## ğŸŒ ç¶²è·¯æ¶æ§‹ / Network Architecture

### ç«¯å£é…ç½® / Port Configuration
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚     æœå‹™        â”‚    ç«¯å£     â”‚           èªªæ˜                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Next.js App     â”‚    3000     â”‚ é–‹ç™¼å’Œç”Ÿç”¢ç’°å¢ƒæ‡‰ç”¨              â”‚
â”‚ Apache HTTP     â”‚    80       â”‚ XAMPP Apache (æœªå•Ÿç”¨)           â”‚
â”‚ Apache HTTP     â”‚    8080     â”‚ Homebrew Apache (å•Ÿç”¨)          â”‚
â”‚ MongoDB         â”‚    27017    â”‚ è³‡æ–™åº«é€£æ¥                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### åŸŸåé…ç½® / Domain Configuration
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚     åŸŸå        â”‚      ç›®æ¨™åœ°å€       â”‚           èªªæ˜           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ localhost       â”‚ 127.0.0.1:8080     â”‚ æœ¬åœ°é–‹ç™¼                â”‚
â”‚ crm.local       â”‚ 127.0.0.1:3000     â”‚ CRM ç³»çµ±                â”‚
â”‚ mysite.local    â”‚ 127.0.0.1:8080     â”‚ æˆ‘çš„ç¶²ç«™                â”‚
â”‚ www.in_crm_system.com â”‚ 127.0.0.1:3000 â”‚ ç¶²éš›ç¶²è·¯ CRM            â”‚
â”‚ cam.ddns.net    â”‚ 172.16.18.161:8080 â”‚ å‹•æ…‹ DNS                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ—„ï¸ è³‡æ–™åº«æ¶æ§‹ / Database Architecture

### MongoDB é›†åˆè¨­è¨ˆ / MongoDB Collection Design

#### ç”¨æˆ¶é›†åˆ / Users Collection
```typescript
interface User {
  _id: ObjectId;
  username: string;
  password: string; // åŠ å¯†å¾Œ
  role: 'admin' | 'trainer' | 'member';
  isActive: boolean;
  profile: {
    displayName: string;
    email: string;
    phone: string;
    avatar?: string;
  };
  permissions: string[];
  createdAt: Date;
  updatedAt: Date;
  lastLoginAt?: Date;
}
```

#### è²¡å‹™è¨˜éŒ„é›†åˆ / Financial Records Collection
```typescript
interface FinancialRecord {
  _id: ObjectId;
  recordType: 'income' | 'expense';
  memberName: string;
  item: string;
  details: string;
  location: string;
  unitPrice: number;
  quantity: number;
  totalAmount: number;
  recordDate: Date; // é¦™æ¸¯æ™‚å€
  createdBy: ObjectId;
  createdAt: Date;
  updatedAt: Date;
}
```

#### å‡ºå¸­è¨˜éŒ„é›†åˆ / Attendance Records Collection
```typescript
interface AttendanceRecord {
  _id: ObjectId;
  memberId: ObjectId;
  activityId: ObjectId;
  attendanceDate: Date;
  status: 'present' | 'absent' | 'late';
  notes?: string;
  recordedBy: ObjectId;
  createdAt: Date;
  updatedAt: Date;
}
```

## ğŸ” å®‰å…¨æ¶æ§‹ / Security Architecture

### èªè­‰æµç¨‹ / Authentication Flow
```
1. ç”¨æˆ¶è¼¸å…¥æ†‘è­‰
   â†“
2. å‰ç«¯é©—è­‰æ ¼å¼
   â†“
3. API è«‹æ±‚åˆ°å¾Œç«¯
   â†“
4. è³‡æ–™åº«é©—è­‰æ†‘è­‰
   â†“
5. ç”Ÿæˆ JWT Token
   â†“
6. è¨­ç½® HTTP-Only Cookie
   â†“
7. è¿”å›æˆåŠŸéŸ¿æ‡‰
```

### æˆæ¬Šæ©Ÿåˆ¶ / Authorization Mechanism
- **è§’è‰²åŸºç¤è¨ªå•æ§åˆ¶ (RBAC):** admin, trainer, member
- **æ¬Šé™æª¢æŸ¥:** æ¯å€‹ API ç«¯é»é€²è¡Œæ¬Šé™é©—è­‰
- **æœƒè©±ç®¡ç†:** JWT Token éæœŸæ™‚é–“è¨­ç½®
- **å®‰å…¨æ¨™é ­:** CORS, CSP, HSTS ç­‰å®‰å…¨æ¨™é ­

## ğŸš€ éƒ¨ç½²æ¶æ§‹ / Deployment Architecture

### é–‹ç™¼ç’°å¢ƒ / Development Environment
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  é–‹ç™¼è€…æ©Ÿå™¨     â”‚
â”‚  (macOS)       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ â€¢ Node.js      â”‚
â”‚ â€¢ Next.js Dev  â”‚
â”‚ â€¢ MongoDB      â”‚
â”‚ â€¢ Apache       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ç”Ÿç”¢ç’°å¢ƒ / Production Environment
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   ç”¨æˆ¶ç«¯        â”‚    â”‚   ç”Ÿç”¢ä¼ºæœå™¨    â”‚
â”‚  (ç€è¦½å™¨)      â”‚â—„â”€â”€â–ºâ”‚  (macOS)       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
                       â”‚ â€¢ Apache       â”‚
                       â”‚ â€¢ Next.js      â”‚
                       â”‚ â€¢ MongoDB      â”‚
                       â”‚ â€¢ SSL è­‰æ›¸     â”‚
                       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ“Š æ€§èƒ½å„ªåŒ– / Performance Optimization

### å‰ç«¯å„ªåŒ– / Frontend Optimization
- **ä»£ç¢¼åˆ†å‰²:** Next.js è‡ªå‹•ä»£ç¢¼åˆ†å‰²
- **åœ–ç‰‡å„ªåŒ–:** Next.js Image çµ„ä»¶
- **å¿«å–ç­–ç•¥:** éœæ…‹è³‡æºå¿«å–
- **æ‡¶åŠ è¼‰:** çµ„ä»¶å’Œè·¯ç”±æ‡¶åŠ è¼‰

### å¾Œç«¯å„ªåŒ– / Backend Optimization
- **è³‡æ–™åº«ç´¢å¼•:** MongoDB è¤‡åˆç´¢å¼•
- **æŸ¥è©¢å„ªåŒ–:** èšåˆç®¡é“å„ªåŒ–
- **é€£æ¥æ± :** MongoDB é€£æ¥æ± ç®¡ç†
- **å¿«å–å±¤:** Redis å¿«å– (å¯é¸)

## ğŸ” ç›£æ§å’Œæ—¥èªŒ / Monitoring and Logging

### æ—¥èªŒé…ç½® / Logging Configuration
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚     æ—¥èªŒé¡å‹    â”‚                   è·¯å¾‘                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Apache è¨ªå•æ—¥èªŒ â”‚ /opt/homebrew/var/log/httpd/access_log     â”‚
â”‚ Apache éŒ¯èª¤æ—¥èªŒ â”‚ /opt/homebrew/var/log/httpd/error_log      â”‚
â”‚ Next.js æ—¥èªŒ    â”‚ console.log (é–‹ç™¼) / æ–‡ä»¶ (ç”Ÿç”¢)            â”‚
â”‚ MongoDB æ—¥èªŒ    â”‚ MongoDB å…§å»ºæ—¥èªŒç³»çµ±                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ç›£æ§æŒ‡æ¨™ / Monitoring Metrics
- **ç³»çµ±æ€§èƒ½:** CPU, è¨˜æ†¶é«”, ç£ç¢Ÿä½¿ç”¨ç‡
- **ç¶²è·¯æ€§èƒ½:** éŸ¿æ‡‰æ™‚é–“, ååé‡
- **æ‡‰ç”¨æ€§èƒ½:** API éŸ¿æ‡‰æ™‚é–“, éŒ¯èª¤ç‡
- **è³‡æ–™åº«æ€§èƒ½:** æŸ¥è©¢æ™‚é–“, é€£æ¥æ•¸

## ğŸ› ï¸ ç¶­è­·å’Œå‚™ä»½ / Maintenance and Backup

### å®šæœŸç¶­è­· / Regular Maintenance
- **æ—¥èªŒè¼ªè½‰:** æ¯é€±æ¸…ç†èˆŠæ—¥èªŒ
- **è³‡æ–™åº«å‚™ä»½:** æ¯æ—¥ MongoDB å‚™ä»½
- **ç³»çµ±æ›´æ–°:** å®šæœŸæ›´æ–°ä¾è³´åŒ…
- **å®‰å…¨æƒæ:** å®šæœŸå®‰å…¨æ¼æ´æƒæ

### å‚™ä»½ç­–ç•¥ / Backup Strategy
- **è³‡æ–™åº«å‚™ä»½:** MongoDB è‡ªå‹•å‚™ä»½
- **é…ç½®æ–‡ä»¶å‚™ä»½:** ç‰ˆæœ¬æ§åˆ¶ç³»çµ±
- **ä»£ç¢¼å‚™ä»½:** Git é ç¨‹å€‰åº«
- **ç½é›£æ¢å¾©:** å®Œæ•´çš„æ¢å¾©æµç¨‹æ–‡æª”

## ğŸ“‹ é…ç½®æ¸…å–® / Configuration Checklist

### Apache é…ç½® / Apache Configuration
- [ ] å•Ÿç”¨ mod_proxy æ¨¡çµ„
- [ ] å•Ÿç”¨ mod_proxy_http æ¨¡çµ„
- [ ] é…ç½®è™›æ“¬ä¸»æ©Ÿ
- [ ] è¨­ç½®åå‘ä»£ç†è¦å‰‡
- [ ] é…ç½® SSL è­‰æ›¸ (ç”Ÿç”¢ç’°å¢ƒ)

### Next.js é…ç½® / Next.js Configuration
- [ ] ç’°å¢ƒè®Šæ•¸é…ç½®
- [ ] è³‡æ–™åº«é€£æ¥é…ç½®
- [ ] JWT å¯†é‘°é…ç½®
- [ ] CORS é…ç½®
- [ ] å¿«å–é…ç½®

### MongoDB é…ç½® / MongoDB Configuration
- [ ] è³‡æ–™åº«é€£æ¥å­—ç¬¦ä¸²
- [ ] ç”¨æˆ¶èªè­‰é…ç½®
- [ ] ç´¢å¼•å‰µå»º
- [ ] å‚™ä»½é…ç½®
- [ ] å®‰å…¨é…ç½®

---

## ğŸ“– æ›´æ–°æ—¥èªŒ / Update Log

### ç‰ˆæœ¬ 1.0.0 (2025-08-13)
- âœ… åˆå§‹æ¶æ§‹è¨­è¨ˆ
- âœ… åŸºæœ¬åŠŸèƒ½å¯¦ç¾
- âœ… å®‰å…¨æ©Ÿåˆ¶é…ç½®
- âœ… éƒ¨ç½²é…ç½®å®Œæˆ

---

## ğŸ“„ ç‰ˆæ¬Šè²æ˜ / Copyright Notice

Â© 2025 CRM Management System. All rights reserved.

æœ¬æ¶æ§‹æ–‡æª”åƒ…ä¾›å…§éƒ¨ä½¿ç”¨ï¼Œæœªç¶“æˆæ¬Šä¸å¾—å¤–å‚³ã€‚
This architecture documentation is for internal use only and may not be distributed without authorization. 